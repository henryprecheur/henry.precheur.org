<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>Testing using Python</title>
<!-- metadata -->
<meta name="generator" content="S5" />
<meta name="version" content="S5 1.1" />
<meta name="presdate" content="20090203" />
<meta name="author" content="Henry Prech&ecirc;eur" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<link rel="stylesheet" href="ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/default/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/default/opera.css" type="text/css" media="projection" id="operaFix" />
<!-- S5 JS -->
<script src="ui/default/slides.js" type="text/javascript"></script>
</head>
<body>

<div class="layout">
<div id="controls"><!-- DO NOT EDIT --></div>
<div id="currentSlide"><!-- DO NOT EDIT --></div>
<div id="header"></div>
<div id="footer"></div>

</div>


<div class="presentation">

<div class="slide">
<h1>Testing using Python</h1>
<h2><a href='mailto:Henry Precheur &lt;henry@precheur.org&gt;'>Henry Pr&ecirc;cheur &lt;henry@precheur.org&gt;</a></h2>
<p>Vancouver Python user group February 2009</p>
</div>


<div class="slide">

<h1>Plan</h1>

<ol>
<li>Introduction: What is testing?</li>
<li>Why test?</li>
<li>Unittest</li>
<li>Doctest</li>
<li>Other cool tools (coverage tools &amp; nose)</li>
</ol>

</div>

<div class="slide">
        <h1>What is testing?</h1>
        <p>Running your code to see if it breaks.</p>
        <ul>
        <li>Testing &ne; debugging</li>
        <li>Testing focuses on detecting errors, not correcting them.</li>
        </ul>
</div>

<div class='slide'>
    <h1>Process</h1>

    <img src='process.png' class='leader'/>
</div>

<div class='slide'>
    <h1>Different kinds of &ldquo;developer test&rdquo;</h1>

    <dl>
        <dt>Unit test</dt>
        <dd>function, class, and small program</dd>
        <dt>Component test</dt>
        <dd>class, package, small program</dd>
        <dt>Integration test</dt>
        <dd>combination of multiple units or components</dd>
        <dt>Regression test</dt>
        <dd>Make sure that what used to work Monday still works Friday</dd>
        <dt>System test</dt>
        <dd>Performance, resource usage, and/or security of the software in its final configuration</dd>
    </dl>

</div>

<div class='slide'>
    <h1>Why test?</h1>

    <h2>You already test your code!</h2>
    <p>Running the code you have just written <strong>is</strong> testing.<p>
    <p>Structure &amp; reuse those tests to be more efficient</p>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <ol>
    <li>Testing helps find bugs &amp; errors</li>
    <li>Writing tests and keeping them is a good way to document how the code works</li>
    <li>Testing is a metric for Quality Assurance</li>
    <li>Great for refactoring (contribution of the audience)</li>
    </ol>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <h2>Make sure new code is correct and defects are fixed</h2>

    <img src='process2.png' class='leader'/>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <h2>Make sure defects are corrected</h2>

    <p>Automated testing is a <strong>great</strong> way to detect regressions.</p>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <p>Important to migrate your project to Python 3.</p>
    <blockquote>
        You should have excellent unit tests with close to full coverage.<br/>
        &#8212; PEP 3000
    </blockquote>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <h2>2to3</h2>

    <img src='2to3.png' class='leader'/>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <h2>Contributing</h2>

    <p>Most big projects (like Python and Django) require tests with code contribution.</p>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <p>Testing <strong>works</strong>.</p>
    <p><em>It's not a trendy technology / language / framework pretending to solve all your problems.</em></p>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <h2>BUT ...</h2>

</div>

<div class='slide'>
    <h1>Why test?</h1>

    <h2>... testing does not find all bugs</h2>
    <blockquote>
        program testing can be a very effective way to show the presence of bugs, but is hopelessly inadequate for showing their absence.<br/>
        &#8212; Edsger W. Dijkstra, <a href='http://www.cs.utexas.edu/~EWD/transcriptions/EWD03xx/EWD340.html'>The Humble Programmer</a>
    </blockquote>
</div>

<div class='slide'>
    <h1>Why test?</h1>

    <h2>... testing does not find all bugs</h2>
    <blockquote>
        Individual testing steps (unit test, component test,, and integration test) typically find less than 50 percent of the errors present each. The combination of testing steps often finds less than 60 percent of the errors present.<br/>
        &#8212; Steve McConnel, <a href='http://cc2e.com/'>Code Complete 2ed</a>
    </blockquote>
</div>

<div class='slide'>
    <h1>Questions so far?</h1>
</div>

<div class='slide'>
    <h1>How to test?</h1>

    <ul>
        <li><a href='http://docs.python.org/library/unittest.html'>Unittest</a> also known as <q>PyUnit</q>, included in the Python standard library</li>
        <li><a href='http://docs.python.org/library/doctest.html'>Doctest</a>, included in the Python standard library</li>
        <li><a href='http://codespeak.net/py/dist/test.html'>py.test</a>, PyPy's testing framework.</li>
        <li><a href='http://sourceforge.net/projects/pyunitperf'>pyUnitPerf</a>, performance-based unit testing</li>
    </ul>
    <p>Only focus on <a href='http://docs.python.org/library/unittest.html'>Unittest</a> and <a href='http://docs.python.org/library/doctest.html'>Doctest</a>.</p>
</div>

<div class='slide'>
    <h1>Unittest</h1>

    <p>Similar to JUnit, the mother of all test frameworks.</p>
</div>

<div class='slide'>
    <h1>Example 1/3</h1>

    <pre><code>import unittest

class MyTestCase(unittest.<span class='highlight'>TestCase</span>):

    def <span class='highlight'>test_add</span>(self):
        # Could also be 'assertTrue' or 'failUnless'
        self.<span class='highlight'>assert_</span>(isinstance(2 + 4, int))

        self.assert_([] + [] == [])
        # More explicit error message if it fails
        self.<span class='highlight'>assertEqual</span>([] + [], [])</code></pre>
</div>

<div class='slide'>
    <h1>Example 2/3</h1>

    <pre><code>def test_div(self):
    self.assertRaises(ZeroDivisionError,
                      lambda: 1 / 0)

    self.assertRaises(ZeroDivisionError,
                      int.__div__, 1, 0)</code></pre>
</div>

<div class='slide'>
    <h1>Example 3/3</h1>

    <pre><code>if __name__ == '__main__':
    import unittest
    unittest.main()</code></pre>
</div>

<div class='slide'>
    <h1>Run the test</h1>
    <pre>$ python test.py
..
----------------------------------------------------------------------
Ran 2 tests in 0.000s

OK</pre>
    <p><code>unittest.main()</code> has handy features.<br/><code>python test.py --help</code> to learn more.</p>
</div>

<div class='slide'>
    <h1>Fixtures 1/2</h1>

    <pre><code>import unittest
import tempfile
import shutils

class MyTestCase(unittest.TestCase):
    def setUp(self):
        # create fixtures
        self.tempdir = tempfile.mkdtemp()

    def tearDown(self):
        # delete fixtures
        shutils.rmtree(self.tempdir)
    ...</code></pre>
</div>

<div class='slide'>
    <h1>Fixtures 2/2</h1>

    <pre><code>def test_fixture_1(self):
    # self.tempdir was just created
    # Create a file
    open(os.path.join(self.tempdir, 'test'), 'w')
    # self.tempdir will be deleted after the function call

def test_fixture_2(self):
    # Check that the file 'test' doesn't exist
    self.assertRaise(IOError, open, os.path.join(self.tempdir, 'test'))</code></pre>
</div>

<div class='slide'>
    <h1>Grouping tests with <code>TestSuite</code></h1>

    <pre><code>suite1 = unittest.TestSuite(MyTestCase1(), MyTestCase2())
suite2 = unittest.TestSuite()
suite2.addTest(MyOtherTestCase())

big_suite = unittest.TestSuite(suite1)
big_suite.addTest(suite2)</code></pre>
    <p>You can also iterate on a <code>TestSuite</code></p>
</div>

<div class='slide'>
    <h1>TestRunner</h1>

    Run tests, used for reporting.
    <ul>
        <li>Using a GUI to run the tests</li>
        <li>Monitor performance</li>
        <li>Send an Email to developers when tests fail</li>
        <li>Run tests with different configurations (ex: different database backends)</li>
    </ul>
</div>

<div class='slide'>
    <h1>And Now for Something<br/>Completely Different</h1>
</div>

<div class='slide'>
    <h1>Doctest</h1>

    <p>Unittest is boring: exactly what you would expect from a test framework.</p>
    <p class='incremental'>Doctest is cool and funky ...</p>
</div>

<div class='slide'>
    <h1>Problem</h1>

    <p>How do I make sure that my documentation and my code are synchronized?</p>
    <img src='process_doc.png' class='leader'/>
    <p class='incremental'>Wait ... Did we see this before?</p>
</div>

<div class='slide'>
    <h1>Solution!</h1>

    <p>Documentation can be tests.</p>
    <p>Doctest transforms documentation into real tests.</p>
</div>

<div class='slide'>
    <h1>Example docstring</h1>

    <pre><code>def factorial(n):
    '''Return the factorial of n, an exact integer &gt;= 0.

        <span class='highlight'>&gt;&gt;&gt; factorial(1)
        1
        &gt;&gt;&gt; [factorial(n) for n in range(6)]
        [1, 1, 2, 6, 24, 120]</span>
    '''
    if n == 0:
        return 1
    else:
        n * factorial(n - 1)
    </code></pre>
</div>

<div class='slide'>
    <h1>Running doctests</h1>

    <pre><code>if __name__ == '__main__':
    import doctest
    doctest.testmod()</code></pre>
</div>

<div class='slide'>
    <h1>Doctest in documentation</h1>

    <p>You can also put doctests in text files and execute those tests.</p>
    <pre><code>This is a documentation file.

The function hello_world() prints 'Hello World'.

    &gt;&gt;&gt; hello_world()
    'Hello World'

More text ...</code></pre>
</div>

<div class='slide'>
    <h1>Doctest checks output and return value</h1>

    <pre><code>def print_and_return(i):
    '''
    &gt;&gt;&gt; print_and_return(42)
    42
    42
    '''
    print i
    return i</pre></code>
    <p><strong>Potential gotcha!</strong></p>
</div>

<div class='slide'>
    <h1>Checking exception</h1>

    <pre><code>def factorial(n):
    '''
    <span class='highlight'>&gt;&gt;&gt; factorial(-1)
    Traceback (most recent call last):
    ...
    ValueError: n must be &gt;= 0</span>
    '''
    if not n &gt;= 0:
        raise ValueError("n must be &gt;= 0")
</div>

<div class='slide'>
    <h1>Ellipsis</h1>

    <pre><code>&gt;&gt;&gt; object() # Doesn't work well with doctest
&lt;object object at 0x20e0c8120&gt;

&gt;&gt;&gt; object() # doctest:+ELLIPSIS
&lt;object object at ...&gt;</code></pre>

</div>

<div class='slide'>
    <h1>Integrating doctest and unittest</h1>

    <pre><code>import unittest
import doctest
import my_module_with_doctests

# suite is a unittest.TestSuite()
suite = doctest.DocTestSuite(my_module_with_doctests)
runner = unittest.TextTestRunner()
runner.run(suite)</code></pre>
</div>

<div class='slide'>
    <p>Doctest good for simple tests, but noticeably bad when things become complex:</p>
    <ul>
    <li>Lots of helpers are needed</li>
    <li>A doctest of 10+ lines tend to be hard to follow</li>
    </ul>
</div>

<div class='slide'>
    <h1>Example of ugly doctests (1/2)</h1>
    <pre style='font-size: 60%; font-weigth: normal; line-height: 1em;'>
    def __init__(self, f):
        '''
        &gt;&gt;&gt; file_content = """title: test
        ... date: 2008-1-1
        ... author: test author
        ... encoding: utf-8
        ...
        ... test."""
        &gt;&gt;&gt; from StringIO import StringIO
        &gt;&gt;&gt; p = Post(StringIO(file_content))
        &gt;&gt;&gt; p
        &lt;Post('test', datetime.date(2008, 1, 1))&gt;
        &gt;&gt;&gt; p.title == 'test'
        True
        &gt;&gt;&gt; import datetime
        &gt;&gt;&gt; p.date == datetime.date(2008, 1, 1)
        True
        &gt;&gt;&gt; p.content == 'test.'
        True
        &gt;&gt;&gt; p.encoding == 'utf-8'
        True
        &gt;&gt;&gt; p.author == 'test author'
        True</pre>
</div>

<div class='slide'>
    <h1>Example of ugly doctests (2/2)</h1>
    <pre style='font-size: 60%; font-weigth: normal; line-height: 1em;'>
        &gt;&gt;&gt; Post(StringIO('title: no payload\\ndate: 2008-1-1'))
        &lt;Post('no payload', datetime.date(2008, 1, 1))&gt;
        &gt;&gt;&gt; Post(StringIO('title: no date'))
        Traceback (most recent call last):
        ...
        PostError: Error in post file &lt;unknown filename&gt;: No date defined
        &gt;&gt;&gt; Post(StringIO("""title: bad encoding
        ... date: 2008-1-1
        ... encoding: bad-encoding"""))
        Traceback (most recent call last):
        ...
        PostError: Error in post file &lt;unknown filename&gt;: unknown encoding: \
bad-encoding
        &gt;&gt;&gt; Post(StringIO("""title: bad date
        ... date: 200008-101-10"""))
        Traceback (most recent call last):
        ...
        PostError: Error in post file &lt;unknown filename&gt;: Unable to parse \
date '200008-101-10'
        (Use YYYY-MM-DD [[HH:MM]:SS] format)
        '''</pre>
        <p>Unreadable mess which should be in a unittest.TestCase</p>
</div>

<div class='slide'>
    <h1>Use Doctest<br/>but don’t rely too much on it!</h1>
    <br/>
    <p>Doctest is for documenting first.</p>
    <p>It is a good practice to <em>duplicate</em> relevant doctests in a unittest.TestCase.</p>
</div>

<div class='slide'>
    <h1>More stuffs: code coverage</h1>

    <p>Code coverage describes the degree to which the source code of a program has been tested.</p>
    <ul>
        <li>A good indicator of how good your tests are.</li>
        <li>Developer usually overestimate their coverage.</li>
    </ul>
</div>

<div class='slide'>
    <h1>More stuffs: code coverage</h1>

    <ul>
        <li>trace in the Python standard library</li>
        <li>coverage.py</li>
        <li>figleaf</li>
    </ul>
</div>

<div class='slide'>
    <h1>More stuffs</h1>

    <p><a href=''>nose</a>: autodiscovery and execution of tests. Works with unittest and doctest.</p>
    <p><code>$ nosetests path/to/project</code></p>
    <p>Similar to py.test <q>without resorting to too much magic</q>.</p>
    <p>nose also support coverage via coverage.py</p>
</div>


<div class="slide">

<h1>Questions?</h1>
<p>Find the presentation’s slides at <span class='clear'>http://</span>henry.precheur.org/vanpyz_test<span class='clear'>/</span></p>
<p>Contact me <a href='mailto:Henry Precheur &lt;henry@precheur.org&gt;'>henry@precheur.org</a>.</p>

</div>

</div>
</body>
</html>
<!-- vim:set encoding=utf-8: -->
